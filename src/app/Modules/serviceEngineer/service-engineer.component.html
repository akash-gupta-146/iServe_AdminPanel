<div class="card">
  <div class="card-header card-header-primary">
    <div class="d-flex justify-content-between">
      <h4 class="card-title ">Service Engineer</h4>

      <div class="dropdown">
        <a class="nav-link ">
          <!-- <i class="material-icons" (click)="managerForm.reset()" data-toggle="modal" data-target="#ManagerFormModal"> add_to_photos</i> -->
          <button class="btn btn-primary transparent " (click)="engineerForm.reset()" data-toggle="modal" data-target="#EngineerFormModal"><i
              class="material-icons" style="font-size: 30px;">
              person_add
            </i></button>
        </a>
      </div>


    </div>

  </div>





  <div class="card-body">
    <div class="table-responsive" id="coll">
      <table class="table table-hover">
        <thead class=" text-primary">
          <th *ngFor="let head of headerRow">
            {{head}}
          </th>
        </thead>
        <tbody *ngFor="let row of dataRows let i =index">
          <tr>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}"><b>{{i+1}}</b></td>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}">{{row.name}}</td>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}">{{row.username}}</td>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}">{{row.email}}</td>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}">{{row.contactNo}}</td>
            <td data-toggle="collapse" (click)="getId( row)" attr.href="#collapseExample{{i}}">{{row.specialist}}</td>
            <td class="change-icon">
              <i class="material-icons mainColor deleteIcon">delete</i>
              <i (click)="getId(row)" data-toggle="modal" data-target="#deleteModal" class="material-icons mainColor deleteChange-icon">delete_forever</i>
            </td>
          </tr>
          <tr class="collapse" data-parent="#coll"  attr.id="collapseExample{{i}}">
            <td colspan=7   class=" incident-details" style="background: whitesmoke;">
              <div class="row" style="margin-top: 20px;">

                <div class="card card-nav-tabs margin-top" style="width: 45%; margin-left: 50px; ">
                  <div>
                    <div class="card-header card-header-info float-right" style="width:150px;">
                      Pincodes
                    </div>
                  </div>
                  <div class="col-md-12 col-sm-12 col-lg-12 col-xs-12">
                    <div style="margin-top: -19px;">
                      <!-- <button *ngIf="!editPinShow" (click)="showEditPin()" class=" btn btn-primary btn-sm backgroundColor editBtn"
                        type="button">Edit</button> -->
                      <form class="form-inline ml-auto">
                        <div class=" no-border">
                          <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-just-icon btn-round " style="background: purple">
                          <i class="material-icons">search</i>
                        </button>
                      </form>
                    </div>
                    <div class="space-between">
                      <div class="activePin">Active</div>
                      <div class="InactivePin">Inactive</div>
                    </div>
                    <div class="row scroll" style="padding-top: 13px;">
                      <div class="col-md-6">

                        <ul *ngFor="let pin of assignpincode">

                          <li class="badge badge-pill badge-primary" style="position: relative;    width: 87px;">
                            {{pin}}
                            <i *ngIf="editPinShow" (click)="removePincode(pin)" class="material-icons iconPosition">
                              remove_circle
                            </i>
                          </li>
                        </ul>
                      </div>
                      <div class="col-md-6" *ngIf="editPinShow">
                        <ul *ngFor="let pin of editpins">

                          <li class="badge badge-pill badge-primary" style="position: relative;    width: 87px;">{{pin}}
                            <i (click)="addPin(pin)" class="material-icons iconPosition">
                              add_circle
                            </i>
                          </li>
                        </ul>
                      </div>
                     
                    </div>
                   <div> <button *ngIf="!editPinShow" (click)="showEditPin()" class=" btn btn-primary btn-sm backgroundColor editBtn float-right"
                    type="button">Edit</button></div>
                    <div *ngIf="editPinShow" class="modal-footer">
                      <div style="margin: auto;">
                        <button (click)="canclePinchanges(row)" class="btn btn-outline-danger" style="padding: 5px;margin-right: 12px;">Cancle</button>
                        <button *ngIf="!changeSuccessfuly" type="submit" (click)="changePincode()" class="btn btn-outline-success"
                          style="padding: 5px;">Save
                          Changes
                        </button>
                        <button *ngIf="changeSuccessfuly " type="button" class="btn btn-outline-success" style="padding: 5px;">
                          <i class="fa fa-spinner fa-spin"></i>submitting
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card card-nav-tabs margin-top" style="width: 45%; margin-left: 20px; ">
                  <div>
                    <div class="card-header card-header-info float-right" style="width:200px;">
                        Engineer Details
                      </div>
                    </div>
                  <!-- <div class="col-md-12 col-sm-12 col-lg-12 col-xs-12">
                    <div class="space-between">
                      <button (click)="editProductCategory()" class="btn btn-primary btn-sm backgroundColor editBtn">Edit</button>
                      <form class="form-inline ml-auto">
                        <div class=" no-border">
                          <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-just-icon btn-round " style="background: purple">
                          <i class="material-icons">search</i>
                        </button>
                      </form>
                    </div>
                    <div class="space-between">
                      <div class="activePin">Active</div>
                      <div class="InactivePin">Inactive</div>
                    </div>
                    <div class="row scroll">
                      <div class="col-md-6">
                        <ul style="list-style-type:none;padding: 0;font-size: 11px;" *ngFor="let type of row.productTypes let i = index">
                          <li>
                            {{i+1}} . {{type.productCategoryName}} <i class="material-icons">
                              remove_circle
                            </i>
                          </li>
                        </ul>

                      </div>
                    </div>


                  </div> -->
                  <div class="col-md-12 col-sm-12 col-lg-12 col-xs-12" style="padding:15px;">
                      <div class="row">
                        <div class="col-md-4 col-lg-4 col-sm-4 ">
                          <img *ngIf="row.picUrl" class="product-image" src="{{row.picUrl}}">
                          <img *ngIf="!row.picUrl " class="product-image" src="/assets/img/user.png">
                        </div>
    
                        <div class="col-md-6 col-lg-6 col-sm-6 col-xs-6">
                          <div *ngIf=" row.name ">
                            <i class="fa fa-user details-icon" aria-hidden="true"></i> <b>{{ row.name }}</b>
                          </div>
                          <div *ngIf="row.contactNo">
                            <i class="fa fa-phone details-icon" aria-hidden="true"></i> {{ row.contactNo }}
                          </div>
                          <div *ngIf=" row.email ">
                            <i class="fa fa-envelope details-icon" aria-hidden="true"></i> {{ row.email}}
                          </div>
                          <div>
                            <i class="fa fa-home details-icon" aria-hidden="true" style="font-size: 18px;"></i>
                            {{row.city}} , {{row.state}} ,
                            {{row.country}}, , {{row.postalCode}}
                          </div>
    
                        </div>
                      </div>
                    </div>
                  
                
                </div>


              </div>


              <div class="card card-nav-tabs margin-top" style="width: 95%; margin-left: 25px;">
                <div>
                  <div class="card-header card-header-info float-right" style="width:150px;">
                      Product Category

                  </div>
                </div>
                <div class="col-md-12 col-sm-12 col-lg-12 col-xs-12">
                    <div class="space-between">
                      <button (click)="editProductCategory()" class=" btn btn-primary btn-sm backgroundColor editBtn"
                        type="button">Edit</button>
                      <form class="form-inline ml-auto">
                        <div class=" no-border">
                          <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-just-icon btn-round " style="background: purple">
                          <i class="material-icons">search</i>
                        </button>
                      </form>
                    </div>
                    <div class="space-between">
                      <div class="activePin">Active</div>
                      <div class="InactivePin">Inactive</div>
                    </div>
                    <div class="row " style="padding-top: 13px;">
                      <div class="col-md-4 scroll">

                        <ul *ngFor="let type of row.productTypes let i = index">

                          <li class="badge badge-pill badge-primary" style="position: relative;    width: 150px;">
                              {{type.productCategoryName}}
                        <i *ngIf="editCatShow" (click)="removeCategory(type)" class="material-icons iconPosition">
                              remove_circle
                            </i>
                          </li>
                        </ul>
                      </div>
                      <div class="col-md-8">
                          <div class="row">
                              <div class="col-md-4">
                                <div class="form-group">
                                  <label> Select Product Categories <span style="color: red;">*</span>
                                  </label>
                                  <button *ngIf="pinIstrue" type="button" class="buttonload">
                                    <i class="fa fa-spinner fa-spin"></i>
                                  </button>
                                  <select class="form-control selectHieght" id="proSubCat" required multiple [(ngModel)]="selectedProductCategories"
                                    name="proSubCat" #proSubCat="ngModel" (ngModelChange)="onProductTypeIdChange()">
                                    <option *ngFor="let product of productCategory" [ngValue]="product">{{product.name}}</option>
                                  </select>
                                  <small [hidden]="proSubCat.valid || proSubCat.untouched" style="color: red">
                                    Product Type options is required
                                  </small>
                  
                                </div>
                  
                              </div>
                              <div *ngIf="selectedProductCategoryChildren?.length > 0" class="col-md-4">
                                <div class="form-group">
                                  <label> Select Product Sub-Categories <span style="color: red;">*</span>
                                  </label>
                                  <button *ngIf="pinIstrue" type="button" class="buttonload">
                                    <i class="fa fa-spinner fa-spin"></i>
                                  </button>
                                  <select class="form-control selectHieght" id="prodTypeOptions" required multiple [(ngModel)]="ProductCategoryTypeIds"
                                    name="prodType" #prodType="ngModel">
                                    <option *ngFor="let product of selectedProductCategoryChildren" [value]="product.id">{{product.name}}</option>
                                  </select>
                                  <small [hidden]="prodType.valid || prodType.untouched" style="color: red">
                                    Product Type options is required
                                  </small>
                                  <button (click)="getProdutId()"> click</button>
                                </div>
                              </div>
                            <div *ngIf="productType?.length > 0" class="col-md-4">
                              <div class="form-group">
                                <label> Select Product Type Ids <span style="color: red;">*</span>
                                </label>
                  
                                <select class="form-control selectHieght" id="prodTypeId" required multiple [(ngModel)]="engineerDetails.productTypeIds"
                                  name="prodTypeId" #prodTypeId="ngModel">
                                  <option *ngFor="let product of productType" [ngValue]="product.id">{{product.name}}</option>
                                </select>
                                <small [hidden]="prodTypeId.valid || prodTypeId.untouched" style="color: red">
                                  Product Type options is required
                                </small>
                  
                              </div>
                  
                            </div>
                                                        </div>

                      </div>
                      <!-- <div class="col-md-6" *ngIf="editCatShow">
                        <ul *ngFor="let Category of editCategorys">

                          <li class="badge badge-pill badge-primary" style="position: relative;    width: 87px;">{{Category}}
                            <i (click)="addCategory(Category)" class="material-icons iconPosition">
                              add_circle
                            </i>
                          </li>
                        </ul>
                      </div> -->
                    </div>
                    <div *ngIf="editCatShow" class="modal-footer">
                      <div style="margin: auto;">
                        <button (click)="cancleChange(row)" class="btn btn-outline-danger" style="padding: 5px;margin-right: 12px;">Cancle</button>
                        <button *ngIf="!changeSuccessfuly" type="submit" (click)="changeCategory()" class="btn btn-outline-success"
                          style="padding: 5px;">Save
                          Changes
                        </button>
                        <button *ngIf="changeSuccessfuly " type="button" class="btn btn-outline-success" style="padding: 5px;">
                          <i class="fa fa-spinner fa-spin"></i>submitting
                        </button>
                      </div>
                    </div>
                  </div>
              </div>

            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="9" style="font-size: 70px; text-align: center;">
              <i *ngIf="isDataLoad" class="fa fa-spinner fa-spin mainColor"></i>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
<!-- Service engineer form -->

<div class="modal fade bd-example-modal-lg" id="EngineerFormModal" tabindex="-1" role="dialog" aria-labelledby="EngineerFormModal"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content   card ">
      <div class="card-header card-header-success card-header-icon">
        <div class="card-icon">
          <i class="material-icons"> person_add
          </i>
        </div>
        <h3 class="card-title">ADD SERVICE ENGINEER</h3>
      </div>
      <div class="modal-body">

        <!-- <new-code> -->
        <form #engineerForm="ngForm">
          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label class="bmd-label-floating" for="name"> Name <span style="color: red;">*</span>

                </label>
                <input type="text" required minlength="4" class="form-control " [(ngModel)]="engineerDetails.name" name="name"
                  id="name" #name="ngModel">
                <small [hidden]="name.valid || name.untouched" style="color: red">
                  Name is required
                </small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>Username <span style="color: red;">*</span>
                </label>
                <input type="text" minlength="4" maxlength="20" required [(ngModel)]="engineerDetails.username" name="username"
                  id="username" class="form-control " #username="ngModel">

                <small [hidden]="username.valid || username.untouched" style="color: red">
                  Username should consist of minimum 6 characters
                </small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>Contact No <span style="color: red;">*</span>
                </label>
                <input type="number" pl required pattern=".{10,11}" class="form-control " [(ngModel)]="engineerDetails.contactNo"
                  name="contactNo" id="contactNo" #contactNo="ngModel">
                <small [hidden]="contactNo.valid || contactNo.untouched" style="color: red">
                  Contact No is required
                </small>
              </div>

            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label>Email Id<span style="color: red;">*</span>
                </label>
                <input type="email" required [(ngModel)]="engineerDetails.email" name="email" id="email" class="form-control "
                  #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}">

                <small [hidden]="email.valid || email.untouched" style="color: red">
                  Email Id is required
                </small>
              </div>
            </div>
            <div class="col-md-4" style="padding: 9px;">
              <label>Profile Picture
              </label>
              <input type="file" (change)="onSelectFile($event)" name="pic" id="pic" class="form-control ">

            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label>Specialization<span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control  " [(ngModel)]="engineerDetails.specialist" name="specialist"
                  id="specialist" #specialist="ngModel">
                <small [hidden]="specialist.valid || specialist.untouched" style="color: red">
                  Specialization is required
                </small>
              </div>
            </div>

          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Password <span style="color: red;">*</span></label>
                <input type="password" required minlength="6" class="form-control  " [(ngModel)]="engineerDetails.password"
                  name="password" id="password" #password="ngModel">
                <small [hidden]="password.valid || password.untouched" style="color: red">
                  Password should consist of minimum 6 characters
                </small>
              </div>
            </div>


            <div class="col-md-6">
              <div class="form-group">
                <label> Select Pin Codes <span style="color: red;">*</span>
                </label>
                <button *ngIf="pinIstrue" type="button" class="buttonload">
                  <i class="fa fa-spinner fa-spin"></i>
                </button>
                <select class="form-control selectHieght" required multiple [(ngModel)]="engineerDetails.pincodes" name="pincode"
                  #pincode="ngModel">
                  <option *ngFor="let pin of pins" [value]="pin.pincode">{{pin.pincode}}</option>
                </select>
                <small [hidden]="pincode.valid || pincode.untouched" style="color: red">
                  Pincode is required
                </small>

              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label> Select Product Categories <span style="color: red;">*</span>
                </label>
                <button *ngIf="pinIstrue" type="button" class="buttonload">
                  <i class="fa fa-spinner fa-spin"></i>
                </button>
                <select class="form-control selectHieght" id="proSubCat" required multiple [(ngModel)]="selectedProductCategories"
                  name="proSubCat" #proSubCat="ngModel" (ngModelChange)="onProductTypeIdChange()">
                  <option *ngFor="let product of productCategory" [ngValue]="product">{{product.name}}</option>
                </select>
                <small [hidden]="proSubCat.valid || proSubCat.untouched" style="color: red">
                  Product Type options is required
                </small>

              </div>

            </div>
            <div *ngIf="selectedProductCategoryChildren?.length > 0" class="col-md-4">
              <div class="form-group">
                <label> Select Product Sub-Categories <span style="color: red;">*</span>
                </label>
                <button *ngIf="pinIstrue" type="button" class="buttonload">
                  <i class="fa fa-spinner fa-spin"></i>
                </button>
                <select class="form-control selectHieght" id="prodTypeOptions" required multiple [(ngModel)]="ProductCategoryTypeIds"
                  name="prodType" #prodType="ngModel">
                  <option *ngFor="let product of selectedProductCategoryChildren" [value]="product.id">{{product.name}}</option>
                </select>
                <small [hidden]="prodType.valid || prodType.untouched" style="color: red">
                  Product Type options is required
                </small>
                <button class="btn btn-primary btn-sm" (click)="getProdutId()" > Next</button>

                <!-- <button (click)="getProdutId()"> click</button> -->
              </div>
            </div>
          
          <div *ngIf="productType?.length > 0" class="col-md-4">
            <div class="form-group">
              <label> Select Product Type Ids <span style="color: red;">*</span>
              </label>

              <select class="form-control selectHieght" id="prodTypeId" required multiple [(ngModel)]="engineerDetails.productTypeIds"
                name="prodTypeId" #prodTypeId="ngModel">
                <option *ngFor="let product of productType" [ngValue]="product.id">{{product.name}}</option>
              </select>
              <small [hidden]="prodTypeId.valid || prodTypeId.untouched" style="color: red">
                Product Type options is required
              </small>

            </div>

          </div>
        </div>
          <div class="row">
            <div class="col-md-10">
              <div class="form-group">
                <label>Address Line <span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control " [(ngModel)]="engineerDetails.address.address" name="addres"
                  #addres="ngModel">
                <small [hidden]="addres.valid || addres.untouched" style="color: red;">
                  Address Line is required
                </small>
              </div>
            </div>

            <div class="col-md-2">
              <div class="form-group">
                <label> City <span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control " [(ngModel)]="engineerDetails.address.city" name="city"
                  id="city" #city="ngModel">
                <small [hidden]="city.valid || city.untouched" style="color: red">
                  City is required
                </small>
              </div>
            </div>


          </div>
          <div class="row">
            <div class="col-md-3">
              <div class="form-group">
                <label> State <span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control " [(ngModel)]="engineerDetails.address.state" name="state"
                  id="state" #state="ngModel">
                <small [hidden]="state.valid || state.untouched" style="color: red">
                  State Name is required
                </small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>Country <span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control " pl [(ngModel)]="engineerDetails.address.country" name="country"
                  id="country" #country="ngModel">
                <small [hidden]="country.valid || country.untouched" style="color: red">
                  Country Name is required
                </small>
              </div>
            </div>


            <div class="col-md-3">
              <div class="form-group">
                <label>Postel Code <span style="color: red;">*</span>
                </label>
                <input type="text" required class="form-control " [(ngModel)]="engineerDetails.address.postalCode" name="postalcode"
                  id="postalcode" #postalcode="ngModel">
                <small [hidden]="postalcode.valid || postalcode.untouched" style="color: red">
                  Postal code is required
                </small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>Select Address Type <span style="color: red;">*</span>
                </label>
                <select class="form-control" required [(ngModel)]="engineerDetails.address.addressType" name="addressType"
                  #addressType="ngModel" style="height: px;">
                  <option *ngFor="let addr of addressTypeOptions" [value]="addr">{{addr}}</option>
                </select>
                <small [hidden]="addressType.valid || addressType.untouched" style="color: red">
                  Address type is required
                </small>
              </div>

            </div>
          </div>
        </form>

        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" *ngIf="!loadingButton" (click)="creatEngineer()" [disabled]="!engineerForm.valid" class="btn btn-success">Submit</button>
          <button type="button" *ngIf="loadingButton"  class="btn btn-success">submitting</button>

        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- Service Engineer form end -->

  <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModal" aria-hidden="true">
      <div class="modal-dialog" role="document">
          <div class="modal-content   card card-stats">
              <div class="card-header card-header-success card-header-icon">
                  <div class="card-icon">
                      <i class="material-icons">delete_outline
                      </i>
                  </div>
                  <h3 class="card-title">Delete</h3>
              </div>
              <div class="modal-body">
                  <h3>"Are you sure you want to delete this Service Engineer?",
                  </h3>
                  <div class="modal-footer">
  
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancle</button>
                      <button type="submit" (click)="deleteEngineer()" class="btn btn-success">Delete</button>
  
                  </div>
              </div>
  
          </div>
      </div>
  </div>
  